<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://howto.pandey.me/favicon.ico><link rel=stylesheet href=/css/style.min.css><title>Read a file line by line from S3 in Node.js</title><script type=text/javascript>(function(e,t){if(!t.__SV){var n,s,o,i;window.mixpanel=t,t._i=[],t.init=function(e,n,o){function c(e,t){var n=t.split(".");2==n.length&&(e=e[n[0]],t=n[1]),e[t]=function(){e.push([t].concat(Array.prototype.slice.call(arguments,0)))}}var r,a=t;"undefined"!=typeof o?a=t[o]=[]:o="mixpanel",a.people=a.people||[],a.toString=function(e){var t="mixpanel";return"mixpanel"!==o&&(t+="."+o),e||(t+=" (stub)"),t},a.people.toString=function(){return a.toString(1)+".people (stub)"},i="disable time_event track track_pageview track_links track_forms track_with_groups add_group set_group remove_group register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking start_batch_senders people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user people.remove".split(" ");for(s=0;s<i.length;s++)c(a,i[s]);r="set set_once union unset remove delete".split(" "),a.get_group=function(){function n(e){t[e]=function(){call2_args=arguments,call2=[e].concat(Array.prototype.slice.call(call2_args,0)),a.push([s,call2])}}for(var t={},s=["get_group"].concat(Array.prototype.slice.call(arguments,0)),e=0;e<r.length;e++)n(r[e]);return t},t._i.push([e,n,o])},t.__SV=1.2,n=e.createElement("script"),n.type="text/javascript",n.async=!0,n.src="undefined"!=typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js",o=e.getElementsByTagName("script")[0],o.parentNode.insertBefore(n,o)}})(document,window.mixpanel||[]),mixpanel.init("999229fb021c338b0b4d5fad8a5f8919")</script></head><body><header id=banner><h2><a href=https://howto.pandey.me/>How To...</a></h2><nav><ul><li><a href=/ title=posts>posts</a></li><li><a href=/tags title=tags>tags</a></li></ul></nav></header><main id=content><article><header id=post-header><h1>Read a file line by line from S3 in Node.js</h1><div><time>January 7, 2022</time></div></header><p>I had to do this recently, and it&rsquo;s actually quite straightforward&mldr; once you know what to do.</p><p>One problem I faced was that all the blogs and <a href=https://stackoverflow.com/>Stack Overflow</a> answers I found were about the <a href=https://aws.amazon.com/sdk-for-javascript/>AWS SDK</a> v2 and they don&rsquo;t work with v3. The following code has been tested with AWS SDK v3.45.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>AWS</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;@aws-sdk/client-s3&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>readline</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;readline&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>readFile</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>bucket</span><span class=p>,</span> <span class=nx>filename</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>s3</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>AWS</span><span class=p>.</span><span class=nx>S3</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>file</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>s3</span><span class=p>.</span><span class=nx>getObject</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>Bucket</span><span class=o>:</span> <span class=nx>bucket</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>Key</span><span class=o>:</span> <span class=nx>filename</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>reader</span> <span class=o>=</span> <span class=nx>readline</span><span class=p>.</span><span class=nx>createInterface</span><span class=p>({</span> <span class=nx>input</span><span class=o>:</span> <span class=nx>file</span><span class=p>.</span><span class=nx>Body</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=kr>await</span> <span class=p>(</span><span class=kr>const</span> <span class=nx>line</span> <span class=k>of</span> <span class=nx>reader</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// process each line
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>see also: <a href=../write-a-file-to-s3-in-node.js/>Write a file to S3 in Node.js</a></p></article></main><footer id=footer>Â© 2021 Sunil Pandey</footer></body></html>